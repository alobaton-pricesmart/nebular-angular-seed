{"version":3,"file":"dynamic-overlay-handler.js","sourceRoot":"","sources":["../../../../../../../.ng_build/theme/components/cdk/overlay/dynamic/dynamic-overlay-handler.ts"],"names":[],"mappings":"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","sourcesContent":["import { ElementRef, Injectable, SimpleChange, Type } from '@angular/core';\nimport { takeUntil } from 'rxjs/operators';\nimport { Subject } from 'rxjs';\n\nimport { NbTrigger, NbTriggerStrategy, NbTriggerStrategyBuilderService } from '../overlay-trigger';\nimport {\n  NbAdjustableConnectedPositionStrategy,\n  NbAdjustment,\n  NbPosition,\n  NbPositionBuilderService,\n} from '../overlay-position';\nimport { NbRenderableContainer } from '../overlay-container';\nimport { NbOverlayContent } from '../overlay';\nimport { NbDynamicOverlay } from './dynamic-overlay';\n\nexport class NbDynamicOverlayChange extends SimpleChange {\n\n  constructor(previousValue: any, currentValue: any, firstChange: boolean = false) {\n    super(previousValue, currentValue, firstChange);\n  }\n\n  isChanged(): boolean {\n    return this.currentValue !== this.previousValue;\n  }\n}\n\n@Injectable()\nexport class NbDynamicOverlayHandler {\n\n  protected _componentType: Type<NbRenderableContainer>;\n  protected _host: ElementRef;\n  protected _context: Object = {};\n  protected _content: NbOverlayContent;\n  protected _trigger: NbTrigger = NbTrigger.NOOP;\n  protected _position: NbPosition = NbPosition.TOP;\n  protected _adjustment: NbAdjustment = NbAdjustment.NOOP;\n  protected _offset: number = 15;\n\n  protected dynamicOverlay: NbDynamicOverlay;\n\n  protected positionStrategy: NbAdjustableConnectedPositionStrategy;\n  protected disconnect$ = new Subject();\n\n  protected changes: { [key: string]: NbDynamicOverlayChange } = {};\n\n  constructor(private positionBuilder: NbPositionBuilderService,\n              private triggerStrategyBuilder: NbTriggerStrategyBuilderService,\n              private dynamicOverlayService: NbDynamicOverlay) {\n  }\n\n  host(host: ElementRef) {\n    this.changes.host = new NbDynamicOverlayChange(this._host, host);\n    this._host = host;\n    return this;\n  }\n\n  trigger(trigger: NbTrigger) {\n    this.changes.trigger = new NbDynamicOverlayChange(this._trigger, trigger);\n    this._trigger = trigger;\n    return this;\n  }\n\n  position(position: NbPosition) {\n    this.changes.position = new NbDynamicOverlayChange(this._position, position);\n    this._position = position;\n    return this;\n  }\n\n  adjustment(adjustment: NbAdjustment) {\n    this.changes.adjustment = new NbDynamicOverlayChange(this._adjustment, adjustment);\n    this._adjustment = adjustment;\n    return this;\n  }\n\n  componentType(componentType: Type<NbRenderableContainer>) {\n    this.changes.componentType = new NbDynamicOverlayChange(this._componentType, componentType);\n    this._componentType = componentType;\n    return this;\n  }\n\n  content(content: NbOverlayContent) {\n    this.changes.content = new NbDynamicOverlayChange(this._content, content);\n    this._content = content;\n    return this;\n  }\n\n  context(context: {}) {\n    this.changes.context = new NbDynamicOverlayChange(this._context, context);\n    this._context = context;\n    return this;\n  }\n\n  offset(offset: number) {\n    this.changes.offset = new NbDynamicOverlayChange(this._offset, offset);\n    this._offset = offset;\n    return this;\n  }\n\n  build() {\n    if (!this._componentType || !this._host) {\n      throw Error(`NbDynamicOverlayHandler: at least 'componentType' and 'host' should be\n      passed before building a dynamic overlay.`)\n    }\n    this.dynamicOverlay = this.dynamicOverlayService.create(\n      this._componentType,\n      this._content,\n      this._context,\n      this.createPositionStrategy(),\n    );\n\n    this.connect();\n    this.clearChanges();\n\n    return this.dynamicOverlay;\n  }\n\n  rebuild() {\n    /**\n     * we should not throw here\n     * as we use rebuilt in lifecycle hooks\n     * which it could be called before the build\n     * so we just ignore this call\n     */\n    if (!this.dynamicOverlay) {\n      return;\n    }\n\n    if (this.isPositionStrategyUpdateRequired()) {\n      this.dynamicOverlay.setPositionStrategy(this.createPositionStrategy());\n    }\n\n    if (this.isTriggerStrategyUpdateRequired()) {\n      this.connect();\n    }\n\n    if (this.isContainerRerenderRequired()) {\n      this.dynamicOverlay.setContentAndContext(this._content, this._context);\n    }\n\n    if (this.isComponentTypeUpdateRequired()) {\n      this.dynamicOverlay.setComponent(this._componentType);\n    }\n\n    this.clearChanges();\n    return this.dynamicOverlay;\n  }\n\n  connect() {\n    if (!this.dynamicOverlay) {\n      throw new Error(`NbDynamicOverlayHandler: cannot connect to DynamicOverlay\n      as it is not created yet. Call build() first`);\n    }\n    this.disconnect();\n    this.subscribeOnTriggers(this.dynamicOverlay);\n  }\n\n  disconnect() {\n    this.disconnect$.next();\n  }\n\n  destroy() {\n    this.disconnect();\n    this.clearChanges();\n    if (this.dynamicOverlay) {\n      this.dynamicOverlay.dispose();\n    }\n  }\n\n  protected createPositionStrategy() {\n    return this.positionBuilder\n      .connectedTo(this._host)\n      .position(this._position)\n      .adjustment(this._adjustment)\n      .offset(this._offset);\n  }\n\n  protected subscribeOnTriggers(dynamicOverlay: NbDynamicOverlay) {\n\n    const triggerStrategy: NbTriggerStrategy = this.triggerStrategyBuilder\n      .trigger(this._trigger)\n      .host(this._host.nativeElement)\n      .container(() => dynamicOverlay.getContainer())\n      .build();\n\n    triggerStrategy.show$.pipe(\n      takeUntil(this.disconnect$),\n    )\n      .subscribe(() => dynamicOverlay.show());\n\n    triggerStrategy.hide$.pipe(\n      takeUntil(this.disconnect$),\n    )\n      .subscribe(() => dynamicOverlay.hide());\n  }\n\n  protected isContainerRerenderRequired() {\n    return this.isContentUpdated()\n      || this.isContextUpdated()\n      || this.isPositionStrategyUpdateRequired();\n  }\n\n  protected isPositionStrategyUpdateRequired(): boolean {\n    return this.isAdjustmentUpdated() || this.isPositionUpdated() || this.isOffsetUpdated() || this.isHostUpdated();\n  }\n\n  protected isTriggerStrategyUpdateRequired(): boolean {\n    return this.isTriggerUpdated() || this.isHostUpdated();\n  }\n\n  protected isComponentTypeUpdateRequired(): boolean {\n    return this.isComponentTypeUpdated();\n  }\n\n  protected isComponentTypeUpdated(): boolean {\n    return this.changes.componentType && this.changes.componentType.isChanged();\n  }\n\n  protected isContentUpdated(): boolean {\n    return this.changes.content && this.changes.content.isChanged();\n  }\n\n  protected isContextUpdated(): boolean {\n    return this.changes.context && this.changes.context.isChanged();\n  }\n\n  protected isAdjustmentUpdated(): boolean {\n    return this.changes.adjustment && this.changes.adjustment.isChanged();\n  }\n\n  protected isPositionUpdated(): boolean {\n    return this.changes.position && this.changes.position.isChanged();\n  }\n\n  protected isHostUpdated(): boolean {\n    return this.changes.host && this.changes.host.isChanged();\n  }\n\n  protected isTriggerUpdated(): boolean {\n    return this.changes.trigger && this.changes.trigger.isChanged();\n  }\n\n  protected isOffsetUpdated(): boolean {\n    return this.changes.offset && this.changes.offset.isChanged();\n  }\n\n  protected clearChanges() {\n    this.changes = {};\n  }\n}\n"]}