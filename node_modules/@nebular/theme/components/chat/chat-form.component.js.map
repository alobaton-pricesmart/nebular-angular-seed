{"version":3,"file":"chat-form.component.js","sourceRoot":"","sources":["../../../../../.ng_build/theme/components/chat/chat-form.component.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Akveo. All Rights Reserved.\n * Licensed under the MIT License. See License.txt in the project root for license information.\n */\n\nimport {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  EventEmitter,\n  HostBinding,\n  HostListener,\n  Input,\n  Output,\n} from '@angular/core';\nimport { DomSanitizer } from '@angular/platform-browser';\n\n/**\n * Chat form component.\n *\n * Show a message form with a send message button.\n *\n * ```ts\n * <nb-chat-form showButton=\"true\" buttonIcon=\"nb-send\">\n * </nb-chat-form>\n * ```\n *\n * When `[dropFiles]=\"true\"` handles files drag&drop with a file preview.\n *\n * Drag & drop available for files and images:\n * @stacked-example(Drag & Drop Chat, chat/chat-drop.component)\n *\n * New message could be tracked outside by using `(send)` output.\n *\n * ```ts\n * <nb-chat-form (send)=\"onNewMessage($event)\">\n * </nb-chat-form>\n *\n * // ...\n *\n * onNewMessage({ message: string, files: any[] }) {\n *   this.service.sendToServer(message, files);\n * }\n * ```\n *\n * @styles\n *\n * chat-form-bg:\n * chat-form-fg:\n * chat-form-border:\n * chat-form-active-border:\n *\n */\n@Component({\n  selector: 'nb-chat-form',\n  template: `\n    <div class=\"dropped-files\" *ngIf=\"droppedFiles?.length\">\n      <ng-container *ngFor=\"let file of droppedFiles\">\n        <div *ngIf=\"file.urlStyle\" [style.background-image]=\"file.urlStyle\">\n          <span class=\"remove\" (click)=\"removeFile(file)\">&times;</span>\n        </div>\n        <div *ngIf=\"!file.urlStyle\" class=\"nb-compose\">\n          <span class=\"remove\" (click)=\"removeFile(file)\">&times;</span>\n        </div>\n      </ng-container>\n    </div>\n    <div class=\"message-row\">\n      <input [(ngModel)]=\"message\"\n             [class.with-button]=\"showButton\"\n             type=\"text\"\n             placeholder=\"{{ fileOver ? 'Drop file to send' : 'Type a message' }}\"\n             (keyup.enter)=\"sendMessage()\">\n      <button *ngIf=\"showButton\" class=\"btn\" [class.with-icon]=\"!buttonTitle\" (click)=\"sendMessage()\">\n        {{ buttonTitle }}<span *ngIf=\"!buttonTitle\" [class]=\"buttonIcon\"></span>\n      </button>\n    </div>\n  `,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n})\nexport class NbChatFormComponent {\n\n  droppedFiles: any[] = [];\n  imgDropTypes = ['image/png', 'image/jpeg', 'image/gif'];\n\n  /**\n   * Predefined message text\n   * @type {string}\n   */\n  @Input() message: string = '';\n\n  /**\n   * Send button title\n   * @type {string}\n   */\n  @Input() buttonTitle: string = '';\n\n  /**\n   * Send button icon, shown if `buttonTitle` is empty\n   * @type {string}\n   */\n  @Input() buttonIcon: string = 'nb-paper-plane';\n\n  /**\n   * Show send button\n   * @type {boolean}\n   */\n  @Input() showButton: boolean = true;\n\n  /**\n   * Show send button\n   * @type {boolean}\n   */\n  @Input() dropFiles: boolean = false;\n\n  /**\n   *\n   * @type {EventEmitter<{ message: string, files: File[] }>}\n   */\n  @Output() send = new EventEmitter<{ message: string, files: File[] }>();\n\n  @HostBinding('class.file-over') fileOver = false;\n\n  constructor(private cd: ChangeDetectorRef, private domSanitizer: DomSanitizer) {\n  }\n\n  @HostListener('drop', ['$event'])\n  onDrop(event: any) {\n    if (this.dropFiles) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      this.fileOver = false;\n      if (event.dataTransfer && event.dataTransfer.files) {\n\n        // tslint:disable-next-line\n        for (let file of event.dataTransfer.files) {\n          const res = file;\n\n          if (this.imgDropTypes.includes(file.type)) {\n            const fr = new FileReader();\n            fr.onload = (e: any) => {\n              res.src = e.target.result;\n              res.urlStyle = this.domSanitizer.bypassSecurityTrustStyle(`url(${res.src})`);\n              this.cd.detectChanges();\n            };\n\n            fr.readAsDataURL(file);\n          }\n          this.droppedFiles.push(res);\n        }\n      }\n    }\n  }\n\n  removeFile(file) {\n    const index = this.droppedFiles.indexOf(file);\n    if (index >= 0) {\n      this.droppedFiles.splice(index, 1);\n    }\n  }\n\n  @HostListener('dragover')\n  onDragOver() {\n    if (this.dropFiles) {\n      this.fileOver = true;\n    }\n  }\n\n  @HostListener('dragleave')\n  onDragLeave() {\n    if (this.dropFiles) {\n      this.fileOver = false;\n    }\n  }\n\n  sendMessage() {\n    if (this.droppedFiles.length || String(this.message).trim().length) {\n      this.send.emit({ message: this.message, files: this.droppedFiles });\n      this.message = '';\n      this.droppedFiles = [];\n    }\n  }\n}\n"]}